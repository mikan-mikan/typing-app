# 画面遷移図

**最終更新日: 2026年01月30日**

## 画面構成

本アプリケーションは5つの主要画面で構成されています。

```
トップ画面 (GameTop)
    ↓
    ├─→ セレクト画面 (SelectCourse)
    │       ↓
    │   ゲーム画面 (TypingGame)
    │       ↓
    │   リザルト画面 (Result)
    │       ↓
    │       └─→ トップ画面 / セレクト画面
    │
    └─→ 設定画面 (Settings)
            ↓
        トップ画面
```

---

## 各画面の説明

### 1. トップ画面 (`GameTop`)

**役割**: アプリケーションのスタート地点

**表示内容**:

- 「スタートする」ボタン → セレクト画面へ遷移
- 「設定画面」ボタン → 設定画面へ遷移

**遷移先**:

- セレクト画面
- 設定画面

---

### 2. セレクト画面 (`SelectCourse`)

**役割**: コースと難易度の選択

**表示内容**:

- **コース選択**: 単語 / 文章
- **難易度選択**: 易しい / 普通 / 難しい
- 「ゲームスタート」ボタン → ゲーム画面へ遷移
- 「TOPに戻る」ボタン → トップ画面へ遷移

**機能**:

- 選択されたコース・難易度に応じて問題リストを生成
- スコアコンテキストをリセット

**遷移先**:

- ゲーム画面
- トップ画面

---

### 3. ゲーム画面 (`TypingGame`)

**役割**: タイピングゲームの実行

**表示内容**:

- 選択した難易度とコースの表示
- 問題文（漢字）
- ローマ字表記（入力済み部分は色分け表示）
- 透明な入力欄
- ミス表示
- 「やめる」ボタン → トップ画面へ遷移

**機能**:

- カウントダウン（3秒）後にゲーム開始
- タイピングの正誤判定
- リアルタイムでの入力処理
- 経過時間の計測
- ミス回数のカウント
- 全問題完了時にリザルト画面へ自動遷移

**遷移先**:

- リザルト画面（自動）
- トップ画面（やめるボタン）

---

### 4. リザルト画面 (`Result`)

**役割**: ゲーム結果の表示

**表示内容**:

- 経過時間
- ミス回数
- 合計秒数（経過時間 + ミスペナルティ）
- スコア評価（VeryFast / Fast / Normal / Slow / VerySlow）
- メッセージ
- 「TOPへ戻る」ボタン → トップ画面へ遷移
- 「コース・難易度 選択画面へ」ボタン → セレクト画面へ遷移

**機能**:

- スコア計算とランク判定
- 結果の保存（コンテキスト内）

**遷移先**:

- トップ画面
- セレクト画面

---

### 5. 設定画面 (`Settings`)

**役割**: ユーザー設定の変更

**表示内容**:

- BGM ON/OFF切り替え
- BGM音量調整
- SE ON/OFF切り替え
- SE音量調整
- 「TOPに戻る」ボタン → トップ画面へ遷移

**機能**:

- 音声設定の保存（コンテキスト内）
- リアルタイムでの設定反映

**遷移先**:

- トップ画面

---

## 画面管理の仕組み

### CurrentScreenContext

全ての画面遷移は `CurrentScreenContext` によって管理されています。

**画面種類（CurrentType）**:

```typescript
type CurrentType = 'トップ' | 'セレクト' | 'ゲーム' | 'リザルト' | 'セッティング';
```

### GameScreen コンポーネント

`GameScreen` コンポーネントが `currentNameCo` の値に応じて表示する画面を切り替えます。

```tsx
{
  currentNameCo === 'トップ' && <GameTop />;
}
{
  currentNameCo === 'セレクト' && <SelectCourse />;
}
{
  currentNameCo === 'ゲーム' && <TypingGame />;
}
{
  currentNameCo === 'リザルト' && <Result />;
}
{
  currentNameCo === 'セッティング' && <Settings />;
}
```

### useGoToPage フック

画面遷移を簡単に行うためのカスタムフック:

```typescript
const { goToPage } = useGoToPage();
goToPage('セレクト'); // セレクト画面へ遷移
```

---

## 注意事項

- 画面遷移時に状態がリセットされる場合と保持される場合があります
- ゲーム開始時はスコアがリセットされます
- 設定画面の変更は即座にコンテキストに保存されます
